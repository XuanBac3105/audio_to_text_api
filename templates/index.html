<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Transcriber</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out forwards',
                        'scale-in': 'scaleIn 0.4s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            'from': { opacity: '0', transform: 'translateY(20px)' },
                            'to': { opacity: '1', transform: 'translateY(0)' }
                        },
                        scaleIn: {
                            'from': { opacity: '0', transform: 'scale(0.95)' },
                            'to': { opacity: '1', transform: 'scale(1)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .upload-zone {
            border: 2px dashed rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }
        .upload-zone:hover {
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(102, 126, 234, 0.08);
            transform: translateY(-2px);
        }
        .upload-zone.drag-over {
            border-color: rgba(102, 126, 234, 0.7);
            background: rgba(102, 126, 234, 0.1);
            box-shadow: 0 12px 24px rgba(102, 126, 234, 0.15);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(102, 126, 234, 0.4);
        }
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .animate-fade-in {
            animation: fadeIn 0.6s ease-out forwards;
            opacity: 0;
        }
        .animate-scale-in {
            animation: scaleIn 0.4s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="bg-white">
    <div class="min-h-screen bg-white">
        <!-- Hero Section -->
        <div class="relative overflow-hidden">
            <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,hsl(262,80%,50%/0.15),transparent_50%)]"></div>
            <div class="container mx-auto px-4 py-12 md:py-20 relative">
                <div class="text-center max-w-3xl mx-auto mb-12">
                    <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-indigo-50 text-indigo-600 text-sm font-medium mb-6 animate-fade-in">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        C√¥ng c·ª• AI chuy·ªÉn ƒë·ªïi gi·ªçng n√≥i
                    </div>
                    <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-6 animate-fade-in" style="animation-delay: 0.1s;">
                        Chuy·ªÉn ƒë·ªïi <span class="gradient-text">Audio</span><br />th√†nh VƒÉn b·∫£n
                    </h1>
                    <p class="text-lg md:text-xl text-gray-600 animate-fade-in" style="animation-delay: 0.2s;">
                        T·∫£i l√™n file audio v√† nh·∫≠n ngay vƒÉn b·∫£n ch√≠nh x√°c.<br class="hidden md:block" />
                        H·ªó tr·ª£ ƒëa ng√¥n ng·ªØ, nhanh ch√≥ng v√† ti·ªán l·ª£i.
                    </p>
                </div>

                <!-- Features -->
                <div class="flex flex-wrap justify-center gap-4 md:gap-8 mb-12 animate-fade-in" style="animation-delay: 0.3s;">
                    <div class="flex items-center gap-3 px-5 py-3 rounded-xl bg-white border border-gray-200">
                        <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/></svg>
                        <div>
                            <p class="font-semibold text-gray-900 text-sm">ƒêa ƒë·ªãnh d·∫°ng</p>
                            <p class="text-xs text-gray-600">MP3, WAV, M4A, FLAC...</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3 px-5 py-3 rounded-xl bg-white border border-gray-200">
                        <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                        <div>
                            <p class="font-semibold text-gray-900 text-sm">Nhanh ch√≥ng</p>
                            <p class="text-xs text-gray-600">X·ª≠ l√Ω trong v√†i gi√¢y</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3 px-5 py-3 rounded-xl bg-white border border-gray-200">
                        <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                        <div>
                            <p class="font-semibold text-gray-900 text-sm">Xu·∫•t file</p>
                            <p class="text-xs text-gray-600">T·∫£i v·ªÅ d·∫°ng TXT</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Section -->
        <div class="container mx-auto px-4 pb-20">
            <div class="max-w-2xl mx-auto space-y-6">
                <!-- Upload Zone -->
                <div class="animate-fade-in" style="animation-delay: 0.4s;">
                    <div class="upload-zone rounded-2xl p-8 md:p-12 cursor-pointer group bg-indigo-50" id="uploadZone">
                        <input type="file" id="fileInput" accept="audio/*" class="hidden" multiple />
                        <div class="flex flex-col items-center gap-4 text-center" id="uploadContent">
                            <div class="w-16 h-16 rounded-2xl bg-indigo-100 flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                                <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                            </div>
                            <div>
                                <p class="text-lg font-semibold text-gray-900 mb-1">K√©o th·∫£ file audio v√†o ƒë√¢y</p>
                                <p class="text-gray-600">ho·∫∑c <span class="text-indigo-600 font-medium">ch·ªçn file</span> t·ª´ m√°y t√≠nh</p>
                            </div>
                            <p class="text-sm text-gray-600">H·ªó tr·ª£: MP3, WAV, M4A, FLAC, OGG (T·ªëi ƒëa 500MB)</p>
                        </div>
                    </div>
                </div>

                <!-- Options Panel -->
                <div id="optionsPanel" class="glass-card rounded-2xl p-6 space-y-6 hidden animate-scale-in">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-900 mb-3">Ng√¥n ng·ªØ</label>
                            <select id="language" class="w-full px-4 py-3 rounded-lg border border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="auto">T·ª± ƒë·ªông nh·∫≠n di·ªán</option>
                                <optgroup label="Ch√¢u √Å">
                                    <option value="vi">üáªüá≥ Ti·∫øng Vi·ªát</option>
                                    <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
                                    <option value="th">üáπüá≠ ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</option>
                                    <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
                                    <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
                                    <option value="hi">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                                    <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                                    <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                                    <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
                                </optgroup>
                                <optgroup label="Ch√¢u √Çu">
                                    <option value="en">üá¨üáß English</option>
                                    <option value="es">üá™üá∏ Espa√±ol</option>
                                    <option value="fr">üá´üá∑ Fran√ßais</option>
                                    <option value="de">üá©üá™ Deutsch</option>
                                    <option value="it">üáÆüáπ Italiano</option>
                                    <option value="pt">üáµüáπ Portugu√™s</option>
                                    <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                                    <option value="pl">üáµüá± Polski</option>
                                    <option value="nl">üá≥üá± Nederlands</option>
                                    <option value="sv">üá∏üá™ Svenska</option>
                                    <option value="da">üá©üá∞ Dansk</option>
                                    <option value="no">üá≥üá¥ Norsk</option>
                                    <option value="fi">üá´üáÆ Suomi</option>
                                    <option value="el">üá¨üá∑ ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨</option>
                                    <option value="hu">üá≠üá∫ Magyar</option>
                                    <option value="cs">üá®üáø ƒåe≈°tina</option>
                                    <option value="ro">üá∑üá¥ Rom√¢nƒÉ</option>
                                    <option value="tr">üáπüá∑ T√ºrk√ße</option>
                                </optgroup>
                                <optgroup label="Trung ƒê√¥ng & Ch√¢u Phi">
                                    <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                                    <option value="he">◊¢◊ë◊®◊ô◊™</option>
                                    <option value="fa">ŸÅÿßÿ±ÿ≥€å</option>
                                    <option value="am">·ä†·àõ·à≠·äõ</option>
                                    <option value="sw">Kiswahili</option>
                                </optgroup>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-900 mb-3">T√™n file k·∫øt qu·∫£</label>
                            <input type="text" id="outputName" value="transcript" class="w-full px-4 py-3 rounded-lg border border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                        </div>
                    </div>
                    <button id="convertBtn" onclick="startTranscribe()" class="w-full h-14 text-base font-semibold text-white btn-primary rounded-lg flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                        B·∫Øt ƒë·∫ßu chuy·ªÉn ƒë·ªïi
                    </button>
                </div>

                <!-- Progress Section -->
                <div id="progressSection" class="glass-card rounded-2xl p-6 space-y-4 hidden">
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <p class="font-semibold text-gray-900" id="progressText">ƒêang x·ª≠ l√Ω...</p>
                            <p class="text-sm text-gray-600" id="progressPercent">0%</p>
                        </div>
                        <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                            <div id="progressBar" class="h-full bg-gradient-to-r from-indigo-600 to-purple-600 transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600" id="elapsedTime">Th·ªùi gian...</p>
                </div>

                <!-- Log Section -->
                <div id="logSection" class="bg-gray-900 rounded-lg p-4 font-mono text-xs text-gray-300 h-40 overflow-y-auto hidden">
                    <div class="text-gray-500">Ch·ªù...</div>
                </div>

                <!-- Log Toggle Button -->
                <div id="logToggle" class="hidden text-center">
                    <button onclick="toggleLog()" class="text-sm text-indigo-600 hover:text-indigo-700 font-medium">
                        <span id="logToggleText">·∫®n log</span>
                    </button>
                </div>

                <!-- Success Toast -->
                <div id="successToast" class="fixed top-4 right-4 bg-green-50 border border-green-200 rounded-lg p-4 shadow-lg hidden">
                    <div class="flex items-center gap-3">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        <div>
                            <p class="font-semibold text-green-900">Chuy·ªÉn ƒë·ªïi th√†nh c√¥ng!</p>
                            <p class="text-sm text-green-700">File audio ƒë√£ ƒë∆∞·ª£c chuy·ªÉn th√†nh vƒÉn b·∫£n.</p>
                        </div>
                    </div>
                </div>

                <!-- Result Section -->
                <div id="resultSection" class="glass-card rounded-2xl p-6 hidden animate-fade-in">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-lg text-gray-900">K·∫øt qu·∫£ chuy·ªÉn ƒë·ªïi</h3>
                        <div class="flex gap-2">
                            <button id="copyBtn" onclick="copyToClipboard()" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-200 text-sm font-medium text-gray-900 hover:bg-gray-50 transition-colors">
                                <svg id="copyIcon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                                <span id="copyText">Sao ch√©p</span>
                            </button>
                            <button onclick="downloadResult()" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm font-medium hover:bg-indigo-700 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                                T·∫£i v·ªÅ
                            </button>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-xl p-4 h-96 overflow-y-auto">
                        <textarea id="resultText" class="w-full h-full bg-transparent text-gray-900 text-base leading-relaxed focus:outline-none resize-none border-0 p-0" readonly></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="border-t border-gray-200 py-8">
            <div class="container mx-auto px-4 text-center">
                <p class="text-gray-600 text-sm">Audio to Text Converter ‚Äî C√¥ng c·ª• chuy·ªÉn ƒë·ªïi gi·ªçng n√≥i th√†nh vƒÉn b·∫£n</p>
            </div>
        </footer>
    </div>

    <script>
        let selectedFiles = [];
        let startTime = null;

        // Ch·ªù DOM load xong tr∆∞·ªõc khi attach events
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, attaching event listeners...');
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('fileInput');
            
            console.log('uploadZone:', uploadZone);
            console.log('fileInput:', fileInput);

            if (!uploadZone || !fileInput) {
                console.error('Elements not found!');
                return;
            }

            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('drag-over');
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('drag-over');
            });

            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('drag-over');
                const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('audio/'));
                if (files.length > 0) {
                    selectedFiles = files;
                    showOptions();
                }
            });

            uploadZone.addEventListener('click', () => {
                console.log('Upload zone clicked, opening file picker...');
                fileInput.click();
            });

            fileInput.addEventListener('change', (e) => {
                console.log('File input changed:', e.target.files);
                selectedFiles = Array.from(e.target.files);
                if (selectedFiles.length > 0) showOptions();
            });
        });

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showOptions() {
            document.getElementById('optionsPanel').classList.remove('hidden');
            const totalSize = formatFileSize(selectedFiles.reduce((sum, f) => sum + f.size, 0));
            let fileDisplay = '';
            
            if (selectedFiles.length === 1) {
                fileDisplay = `
                    <div class="glass-card rounded-lg p-4 w-full">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-lg bg-indigo-100 flex items-center justify-center flex-shrink-0">
                                <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
                                </svg>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="font-semibold text-gray-900 truncate">${selectedFiles[0].name}</p>
                                <p class="text-sm text-gray-600">${totalSize}</p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                fileDisplay = `
                    <div class="glass-card rounded-lg p-4 w-full">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-lg bg-indigo-100 flex items-center justify-center flex-shrink-0">
                                <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
                                </svg>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="font-semibold text-gray-900">${selectedFiles.length} t·ªáp ƒë∆∞·ª£c ch·ªçn</p>
                                <p class="text-sm text-gray-600">${totalSize}</p>
                                <p class="text-xs text-gray-500 mt-1">${selectedFiles.map(f => f.name).join(', ')}</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('uploadContent').innerHTML = fileDisplay;
        }

        function addLog(message) {
            const logBox = document.querySelector('#logSection');
            if (logBox.children[0].textContent.includes('Ch·ªù')) {
                logBox.innerHTML = '';
            }
            const line = document.createElement('div');
            line.textContent = message;
            logBox.appendChild(line);
            logBox.scrollTop = logBox.scrollHeight;
        }

        async function startTranscribe() {
            if (selectedFiles.length === 0) {
                alert('Vui l√≤ng ch·ªçn file audio!');
                return;
            }

            const convertBtn = document.getElementById('convertBtn');
            convertBtn.disabled = true;
            document.getElementById('optionsPanel').classList.add('hidden');
            document.getElementById('progressSection').classList.remove('hidden');
            document.getElementById('logSection').classList.remove('hidden');
            document.getElementById('resultSection').classList.add('hidden');
            document.querySelector('#logSection').innerHTML = '<div class="text-gray-500">Kh·ªüi t·∫°o...</div>';

            const formData = new FormData();
            selectedFiles.forEach(file => formData.append('files', file));
            formData.append('language', document.getElementById('language').value);
            formData.append('output_name', document.getElementById('outputName').value);

            startTime = Date.now();
            const timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const mins = Math.floor(elapsed / 60);
                const secs = elapsed % 60;
                document.getElementById('elapsedTime').textContent = `Th·ªùi gian: ${mins}m ${secs}s`;
            }, 1000);

            try {
                addLog('Uploading...');
                const response = await fetch('/upload', { method: 'POST', body: formData });

                if (response.ok) {
                    addLog('Upload complete');
                    pollLogs(timerInterval);
                } else {
                    addLog('Upload failed');
                    clearInterval(timerInterval);
                    convertBtn.disabled = false;
                }
            } catch (error) {
                addLog('Error: ' + error.message);
                clearInterval(timerInterval);
                convertBtn.disabled = false;
            }
        }

        function pollLogs(timerInterval) {
            const interval = setInterval(async () => {
                try {
                    const response = await fetch('/logs');
                    const data = await response.json();

                    data.logs.forEach(log => addLog(log));

                    const status = data.status;
                    if (status.running && status.total > 0) {
                        const percent = Math.round((status.current / status.total) * 100);
                        document.getElementById('progressBar').style.width = percent + '%';
                        document.getElementById('progressPercent').textContent = percent + '%';
                        document.getElementById('progressText').textContent = `Processing ${status.current}/${status.total}`;
                    }

                    if (data.logs.some(log => log.includes('DONE'))) {
                        clearInterval(interval);
                        clearInterval(timerInterval);
                        document.getElementById('progressBar').style.width = '100%';
                        document.getElementById('progressPercent').textContent = '100%';
                        document.getElementById('progressText').textContent = 'Complete!';

                        const filename = document.getElementById('outputName').value || 'transcript';
                        try {
                            const resultResponse = await fetch('/download/' + filename + '.txt');
                            if (resultResponse.ok) {
                                const resultText = await resultResponse.text();
                                document.getElementById('resultText').value = resultText;
                                
                                // ·∫®n log, hi·ªán result v√† button toggle
                                document.getElementById('logSection').classList.add('hidden');
                                document.getElementById('logToggle').classList.remove('hidden');
                                document.getElementById('resultSection').classList.remove('hidden');
                                
                                // Show success toast
                                const toast = document.getElementById('successToast');
                                toast.classList.remove('hidden');
                                setTimeout(() => {
                                    toast.classList.add('hidden');
                                }, 3000);
                            }
                        } catch (e) {
                            console.log('Fetch result:', e);
                        }

                        addLog('Done!');
                        document.getElementById('convertBtn').disabled = false;
                    }
                } catch (error) {
                    console.error('Poll:', error);
                }
            }, 1000);
        }

        function downloadResult() {
            const filename = document.getElementById('outputName').value || 'transcript';
            window.location.href = '/download/' + filename + '.txt';
        }

        function copyToClipboard() {
            const text = document.getElementById('resultText').value;
            navigator.clipboard.writeText(text).then(() => {
                const copyIcon = document.getElementById('copyIcon');
                const copyText = document.getElementById('copyText');
                const copyBtn = document.getElementById('copyBtn');
                
                // Change to checkmark
                copyIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>';
                copyText.textContent = 'ƒê√£ sao ch√©p';
                copyBtn.classList.add('border-green-200', 'bg-green-50', 'text-green-900');
                
                setTimeout(() => {
                    copyIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>';
                    copyText.textContent = 'Sao ch√©p';
                    copyBtn.classList.remove('border-green-200', 'bg-green-50', 'text-green-900');
                }, 2000);
            });
        }

        function toggleLog() {
            const logSection = document.getElementById('logSection');
            const logToggleText = document.getElementById('logToggleText');
            
            if (logSection.classList.contains('hidden')) {
                logSection.classList.remove('hidden');
                logToggleText.textContent = '·∫®n log';
            } else {
                logSection.classList.add('hidden');
                logToggleText.textContent = 'Hi·ªán log';
            }
        }
    </script>
</body>
</html>